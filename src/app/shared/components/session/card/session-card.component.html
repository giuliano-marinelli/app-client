<mat-card [appearance]="'raised'" [class]="loading ? ['loading', 'brightness-50'] : []">
  @if (loading) {
    <div class="overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  }
  <!-- Add padding-top when loading to fix content shift -->
  <mat-card-content [class.pt-4!]="loading">
    <div class="flex flex-row">
      <mat-icon class="icon-size-10 shrink-0">
        {{ deviceTypeIcon(session.device?.type) }}
      </mat-icon>
      <div class="grow text-center">
        {{
          session.device?.brand
            ? session.device?.brand + ' ' + (session.device?.model ? session.device?.model : '')
            : session.device?.os
              ? session.device?.os
              : 'Unknown'
        }}
      </div>
      @if (session.token != auth.getToken() && !session.blockedAt && !session.closedAt) {
        <button matIconButton class="cursor-pointer" [matMenuTriggerFor]="menu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <a mat-menu-item (click)="confirmClose.open()"><mat-icon>logout</mat-icon> Close session</a>
        </mat-menu>
        <confirm #confirmClose (confirm)="closeSession(session)"></confirm>
      }
    </div>
    @if (session.blockedAt) {
      <div class="mt-2 flex flex-row gap-2 justify-end text-error">
        <mat-icon class="icon-inline-base shrink-0">lock</mat-icon>
        <div>Blocked</div>
      </div>
    }
    @if (session.closedAt && !session.blockedAt) {
      <div class="mt-2 flex flex-row gap-2 justify-end text-muted">
        <mat-icon class="icon-inline-base shrink-0">cancel</mat-icon>
        <div>Closed</div>
      </div>
    }
    @if (session.token == auth.getToken()) {
      <div class="mt-2 flex flex-row gap-2 justify-end text-success">
        <mat-icon class="icon-inline-base shrink-0">check_circle</mat-icon>
        <div>Current device</div>
      </div>
    }
    @if (session.device?.ip) {
      <div class="mt-2 flex flex-row gap-2 text-muted">
        <mat-icon class="icon-inline-sm shrink-0">language</mat-icon>
        <div class="text-sm">{{ session.device?.ip }}</div>
      </div>
    }
    <mat-divider class="mt-2!"></mat-divider>
    <div class="text-sm mt-2"><b>First login:</b> {{ session.createdAt | amLocal | amDateFormat: 'LLL' }}</div>
    <div class="text-sm mt-2">
      <b> {{ session.closedAt || session.blockedAt ? 'Last' : 'Recent' }} activity: </b>
      {{ session.updatedAt | amLocal | amTimeAgo }}
    </div>
    <mat-divider class="mt-2!"></mat-divider>
    @if (session.device?.client) {
      <div class="mt-2 flex flex-row gap-2">
        @if (browserIcon(session.device?.client) == 'unknown') {
          <mat-icon class="icon-inline-sm shrink-0">travel_explore</mat-icon>
        } @else {
          <mat-icon class="icon-inline-sm shrink-0" svgIcon="{{ browserIcon(session.device?.client) }}"></mat-icon>
        }
        <div class="text-sm">{{ session.device?.client }}</div>
      </div>
    }
  </mat-card-content>
</mat-card>
