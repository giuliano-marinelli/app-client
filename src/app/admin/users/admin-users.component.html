@if (usersLoading && !users) {
  <mat-spinner class="justify-self-center" diameter="60"></mat-spinner>
} @else if (!users) {
  <div class="justify-self-center flex flex-col items-center"><mat-icon class="icon-size-20 text-muted!">search_off</mat-icon> No account found</div>
} @else {
  <h1>
    Users
    <button matIconButton class="inline-block! float-end" [disabled]="usersLoading" (click)="getUsers()">
      <mat-icon>refresh</mat-icon>
    </button>
    <mat-spinner class="inline-block! ml-2" diameter="24" [hidden]="!usersLoading"></mat-spinner>
  </h1>
  <mat-divider class="mt-2!"></mat-divider>
  <div [class.loading]="usersLoading">
    @if (!users.length) {
      <div class="justify-self-center flex flex-col items-center mt-3">
        <mat-icon class="icon-size-20 text-muted!">search_off</mat-icon> No users found
      </div>
    }
    @if (users.length) {
      <div class="flex flex-row items-center">
        <mat-paginator
          class="shrink-0"
          [length]="usersCount"
          [pageIndex]="usersPage"
          [pageSize]="usersPageSize"
          [hidePageSize]="true"
          (page)="usersPageOrViewChange($event)"
        >
        </mat-paginator>
        @if (!$isSmallScreen) {
          <div class="w-full text-end">
            <mat-button-toggle-group [value]="usersListView" (change)="usersPageOrViewChange(undefined, $event.value)">
              <mat-button-toggle value="columns">
                <mat-icon>view_column</mat-icon>
              </mat-button-toggle>
              <mat-button-toggle value="rows">
                <mat-icon>view_headline</mat-icon>
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        }
      </div>

      <ngx-masonry #masonry class="-mx-1" [options]="{ percentPosition: true, horizontalOrder: false }" [ordered]="true">
        @for (user of users; track trackByUser(user)) {
          <div ngxMasonryItem class="masonry-item mb-2 px-1 w-full" [class]="usersListView === 'columns' ? ['md:w-1/2', 'xl:w-1/3'] : []">
            <user-card
              [user]="user"
              [masonry]="masonry"
              [loading]="submitLoading.includes(user.id!)"
              (onDelete)="getUsers()"
              (onSessionClose)="getUsers()"
            ></user-card>
          </div>
        }
      </ngx-masonry>

      <mat-paginator
        [length]="usersCount"
        [pageIndex]="usersPage"
        [pageSize]="usersPageSize"
        [pageSizeOptions]="[10, 25, 50, 75, 100]"
        (page)="usersPageOrViewChange($event)"
      >
      </mat-paginator>
    }
  </div>
}
