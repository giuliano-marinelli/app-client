<mat-card class="operation-card" [appearance]="$isSmallScreen ? 'outlined' : 'raised'">
  @if (!code) {
    <form [formGroup]="forgotPasswordForm" (ngSubmit)="sendPasswordResetEmail()">
      <mat-card-content class="operation-content">
        <div class="operation-content-left">
          <mat-icon class="operation-icon">badge</mat-icon>
          <h1 class="mt-3">{{ 'passwordReset.title' | transloco }}</h1>
        </div>
        <div class="operation-content-right">
          <p class="text-muted">
            {{ 'passwordReset.forgotForm.subtitle' | transloco }}
          </p>

          <mat-form-field appearance="outline" [floatLabel]="'always'" [subscriptSizing]="'dynamic'" [hideRequiredMarker]="true">
            <mat-label>{{ 'passwordReset.forgotForm.labels.emailOrUsername' | transloco }}</mat-label>
            <input matInput formControlName="usernameOrEmail" />
            <mat-icon matSuffix>email</mat-icon>
            <mat-error>
              <invalid-feedback
                name="{{ 'passwordReset.forgotForm.labels.emailOrUsername' | transloco }}"
                [control]="usernameOrEmail"
              ></invalid-feedback>
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions class="operation-actions">
        <button matButton="tonal" class="whitespace-nowrap" [disabled]="!forgotPasswordForm.valid || submitLoading">
          @if (submitLoading) {
            <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
          }
          {{ 'passwordReset.forgotForm.buttons.submit' | transloco }}
        </button>
      </mat-card-actions>
    </form>
  } @else {
    <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()">
      <mat-card-content class="operation-content">
        <div class="operation-content-left">
          <mat-icon class="operation-icon">lock_reset</mat-icon>
          <h1 class="mt-3">{{ 'passwordReset.title' | transloco }}</h1>
        </div>
        <div class="operation-content-right">
          <p class="text-muted">{{ 'passwordReset.resetForm.subtitle' | transloco }}</p>

          <mat-form-field
            appearance="outline"
            *var="{ active: true } as hidden"
            [floatLabel]="'always'"
            [subscriptSizing]="'dynamic'"
            [hideRequiredMarker]="true"
          >
            <mat-label>{{ 'passwordReset.resetForm.labels.password' | transloco }}</mat-label>
            <input matInput formControlName="password" [type]="hidden.active ? 'password' : 'text'" />
            <button matIconButton matSuffix (click)="hidden.active = !hidden.active; $event.preventDefault()">
              <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error>
              <invalid-feedback name="{{ 'passwordReset.resetForm.labels.password' | transloco }}" [control]="password"></invalid-feedback>
            </mat-error>
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            *var="{ active: true } as hidden"
            [floatLabel]="'always'"
            [subscriptSizing]="'dynamic'"
            [hideRequiredMarker]="true"
          >
            <mat-label>{{ 'passwordReset.resetForm.labels.confirmPassword' | transloco }}</mat-label>
            <input matInput formControlName="confirmPassword" autocomplete="off" [type]="hidden.active ? 'password' : 'text'" />
            <button matSuffix matIconButton (click)="hidden.active = !hidden.active; $event.preventDefault()">
              <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error>
              <invalid-feedback
                name="{{ 'passwordReset.resetForm.labels.password' | transloco }}"
                [control]="confirmPassword"
                [messages]="{ equalTo: ('passwordReset.errors.passwordEqual' | transloco) }"
              ></invalid-feedback>
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions class="operation-actions">
        <button matButton="tonal" class="whitespace-nowrap" [disabled]="!resetPasswordForm.valid || submitLoading">
          @if (submitLoading) {
            <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
          }
          {{ 'passwordReset.resetForm.buttons.submit' | transloco }}
        </button>
      </mat-card-actions>
    </form>
  }
</mat-card>
