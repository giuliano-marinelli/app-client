<mat-card class="operation-card" [appearance]="$isSmallScreen ? 'outlined' : 'raised'">
  @if (!code) {
    <form [formGroup]="forgotPasswordForm" (ngSubmit)="sendPasswordResetEmail()">
      <mat-card-content class="operation-content">
        <div class="operation-content-left">
          <mat-icon class="operation-icon">badge</mat-icon>
          <h1 class="mt-3">Reset your password</h1>
        </div>
        <div class="operation-content-right">
          <p class="text-muted">
            Please enter your username or a verified email address and we will send you a password reset link to your primary email.
          </p>

          <mat-form-field appearance="outline" [floatLabel]="'always'" [subscriptSizing]="'dynamic'" [hideRequiredMarker]="true">
            <mat-label>Email or username</mat-label>
            <input matInput formControlName="usernameOrEmail" />
            <mat-icon matSuffix>email</mat-icon>
            <mat-error>
              <invalid-feedback [control]="usernameOrEmail" name="Email or username"></invalid-feedback>
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions class="operation-actions">
        <button class="whitespace-nowrap" matButton="tonal" [disabled]="!forgotPasswordForm.valid || submitLoading">
          @if (submitLoading) {
            <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
          }
          Send password reset email
        </button>
      </mat-card-actions>
    </form>
  } @else {
    <form [formGroup]="resetPasswordForm" (ngSubmit)="resetPassword()">
      <mat-card-content class="operation-content">
        <div class="operation-content-left">
          <mat-icon class="operation-icon">lock_reset</mat-icon>
          <h1 class="mt-3">Reset your password</h1>
        </div>
        <div class="operation-content-right">
          <p class="text-muted">Please assign a new password for your account.</p>

          <mat-form-field
            appearance="outline"
            [floatLabel]="'always'"
            [subscriptSizing]="'dynamic'"
            [hideRequiredMarker]="true"
            *var="{ active: true } as hidden"
          >
            <mat-label>Password</mat-label>
            <input matInput [type]="hidden.active ? 'password' : 'text'" formControlName="password" />
            <button
              type="button"
              matIconButton
              matSuffix
              (click)="hidden.active = !hidden.active; $event.preventDefault()"
              [attr.aria-label]="'Hide password'"
              [attr.aria-pressed]="hidden.active"
            >
              <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error>
              <invalid-feedback [control]="password" name="Password"></invalid-feedback>
            </mat-error>
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            [floatLabel]="'always'"
            [subscriptSizing]="'dynamic'"
            [hideRequiredMarker]="true"
            *var="{ active: true } as hidden"
          >
            <mat-label>Repeat Password</mat-label>
            <input matInput [type]="hidden.active ? 'password' : 'text'" formControlName="confirmPassword" autocomplete="off" />
            <button
              type="button"
              matIconButton
              matSuffix
              (click)="hidden.active = !hidden.active; $event.preventDefault()"
              [attr.aria-label]="'Hide password'"
              [attr.aria-pressed]="hidden.active"
            >
              <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error>
              <invalid-feedback name="Password" [control]="confirmPassword" [messages]="{ equalTo: 'Passwords must be equals' }"></invalid-feedback>
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions class="operation-actions">
        <button class="whitespace-nowrap" matButton="tonal" [disabled]="!resetPasswordForm.valid || submitLoading">
          @if (submitLoading) {
            <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
          }
          Reset password
        </button>
      </mat-card-actions>
    </form>
  }
</mat-card>
