<div class="container mb-3">
  <div class="my-4 text-center">
    <fa-icon [icon]="'passport'" size="6x"></fa-icon>
  </div>
  <div class="m-auto" style="max-width: 510px;">
    <h3 class="fs-3 fw-light text-center">Reset your password</h3>
    <div class="alert alert-dark rounded-3">
      <div #message_container></div>
      <form *ngIf="!code" [formGroup]="forgotPasswordForm" (ngSubmit)="sendPasswordResetEmail()">
        <div class="mb-3">
          <label class="form-label">Enter your username or a verified email address and we will send you a password
            reset link to your primary email.</label>
          <input class="form-control" type="text" name="usernameOrEmail" formControlName="usernameOrEmail" autofocus
            [ngClass]="setValid(usernameOrEmail)" />
          <div class="invalid-feedback">
            <div *ngIf="usernameOrEmail?.errors?.['required']">
              Username or email is required.
            </div>
            <div *ngIf="usernameOrEmail?.errors?.['minlength'] || usernameOrEmail?.errors?.['maxlength']">
              Username or email must be at 4-100 characters long
            </div>
          </div>
        </div>
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-success text-white"
            [disabled]="!forgotPasswordForm.valid || submitLoading">
            Send password reset mail <fa-icon *ngIf="submitLoading" [icon]="'spinner'" [spin]="true"
              [pulse]="true"></fa-icon>
          </button>
        </div>
      </form>
      <form *ngIf="code" [formGroup]="passwordResetForm" (ngSubmit)="resetPassword()">
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input class="form-control" type="password" name="password" formControlName="password"
            autocomplete="new-password" [ngClass]="setValid(password)" />
          <div class="invalid-feedback">
            <div *ngIf="password?.errors?.['required']">
              Password is required
            </div>
            <div *ngIf="password?.errors?.['minlength'] || password?.errors?.['maxlength']">
              Password must be at 8-100 characters long
            </div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Repeat Password</label>
          <input class="form-control" type="password" name="confirmPassword" formControlName="confirmPassword"
            autocomplete="off" [ngClass]="setValid(confirmPassword)" />
          <div class="invalid-feedback">
            <div *ngIf="confirmPassword?.errors?.['required']">
              This field is required
            </div>
            <div *ngIf="confirmPassword?.errors?.['equalTo']">
              Passwords must be equals
            </div>
          </div>
        </div>
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-success text-white"
            [disabled]="!passwordResetForm.valid || submitLoading">
            Reset Password <fa-icon *ngIf="submitLoading" [icon]="'spinner'" [spin]="true" [pulse]="true"></fa-icon>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>