<div class="container mb-3">
  <div class="row mt-3 text-center" *ngIf="userLoading && !user">
    <fa-icon [icon]="'spinner'" [spin]="true" [pulse]="true" size="3x"></fa-icon>
  </div>
  <div class="text-center mt-3" *ngIf="!userLoading && !user">
    <fa-icon class="fa-fade" [icon]="'magnifying-glass'" size="3x"></fa-icon>
    <p class="mt-2">No account found</p>
  </div>
  <form *ngIf="user" [formGroup]="usernameForm">
    <div class="mt-3 mt-sm-0 border-bottom">
      <h4>Change username <a class="btn p-0 text-muted border-0" [hidden]="!userLoading" [class.disabled]="userLoading">
          <fa-icon [icon]="'rotate-right'" size="lg" [spin]="userLoading" [pulse]="userLoading"></fa-icon>
        </a>
      </h4>
    </div>
    <div #message_container_update></div>
    <div class="mt-3 mb-3 col-12 col-md-6">
      <div class="input-spinner">
        <input class="form-control bg-dark-subtle" type="text" name="username" formControlName="username"
          [ngClass]="setValid(username)" autocomplete="off">
        <fa-icon *ngIf="username.pending" [icon]="'spinner'" [spin]="true" [pulse]="true"></fa-icon>
        <div class="invalid-feedback">
          <div *ngIf="username.errors && username.errors['required']">
            Username is required
          </div>
          <div *ngIf="username.errors && (username.errors['minlength'] || username.errors['maxlength'])">
            Username must be at 4-30 characters long
          </div>
          <div *ngIf="username.errors && username.errors['pattern']">
            Username can only have characters, numbers and _ or - symbols
          </div>
          <div *ngIf="username.errors && username.errors['usernameExists']">
            Username is already taken, please try another one
          </div>
        </div>
      </div>
    </div>
    <div>
      <button type="button" class="btn btn-success text-white" (click)="updateUsername()"
        [disabled]="!usernameForm.valid || updateSubmitLoading || deleteSubmitLoading">
        Update username <fa-icon *ngIf="updateSubmitLoading" [icon]="'spinner'" [spin]="true" [pulse]="true"></fa-icon>
      </button>
    </div>

    <div class="mt-4 border-bottom text-danger">
      <h4>Delete account</h4>
    </div>
    <div #message_container_delete></div>
    <p class="mt-3 mb-3">Once you delete your account, there is no going back. Please be certain.</p>
    <button type="button" class="btn btn-outline-danger" (confirm)="deleteUser($event)" [requiredPassword]="true"
      [disabled]="updateSubmitLoading || deleteSubmitLoading">
      Delete your account <fa-icon *ngIf="deleteSubmitLoading" [icon]="'spinner'" [spin]="true" [pulse]="true">
      </fa-icon>
    </button>
  </form>
</div>