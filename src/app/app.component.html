<mat-sidenav-container class="sidenav-container">
  <!-- Sidenav -->
  <mat-sidenav #drawer class="sidenav" mode="over" [fixedInViewport]="true" role="navigation" [autoFocus]="false">
    <!-- Sidenav Toolbar -->
    <ng-container *ngTemplateOutlet="toolbar"></ng-container>
    <!-- Sidenav Navigation -->
    <ng-container *ngTemplateOutlet="navigation"></ng-container>
  </mat-sidenav>

  <!-- Content -->
  <mat-sidenav-content>
    <!-- Main Toolbar -->
    <ng-container *ngTemplateOutlet="toolbar; context: { fixed: true }"></ng-container>
    <!-- Main Navigation -->
    <div class="nav" [class.full]="$isFullNav && $isLargeScreen" [class.hidden]="$isSmallScreen">
      <ng-container *ngTemplateOutlet="navigation; context: { fixed: true }"></ng-container>
    </div>
    <!-- Main Content -->
    <div class="content" [class.full]="$isFullNav && $isLargeScreen" [class.expanded]="$isSmallScreen">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #toolbar let-fixed="fixed">
  <mat-toolbar class="toolbar" [class.fixed]="fixed">
    <button matIconButton (click)="$isLargeScreen ? toggleFullNav() : drawer.toggle()" onclick="this.blur()">
      <mat-icon>menu</mat-icon>
    </button>
    <a class="logo" routerLink="/">
      <mat-icon>logo_dev</mat-icon>
      <span>App</span>
    </a>
    @if (fixed) {
      <span class="mat-spacer"></span>
      @if (!auth.loading && auth.user) {
        <!-- User Logged In -->
        <button matIconButton [matMenuTriggerFor]="menu" class="profile-button" (click)="menuPages.resetPages()">
          <img [src]="auth.user.profile?.avatar" class="profile-img" onerror="this.src='assets/images/default-user.png'" />
        </button>
      } @else if (!auth.loading) {
        <!-- Not Logged User -->
        <!-- Config Menu -->
        <div *var="{ section: 'main' } as configMenuOptions">
          <button matIconButton [matMenuTriggerFor]="menu" (click)="menuPages.resetPages()">
            <mat-icon>more_vert</mat-icon>
          </button>
        </div>
        <!-- Sign In -->
        <a matButton="outlined" routerLink="/login">
          <mat-icon>account_circle</mat-icon>
          Sign in
        </a>
      } @else {
        <mat-spinner [diameter]="36"></mat-spinner>
      }
      <mat-menu #menu="matMenu" class="mat-multi-page-menu menu">
        <mat-multi-page-menu #menuPages="matMultiPageMenu">
          <menu-page>
            @if (!auth.loading && auth.user) {
              <div class="mat-menu-item-info menu-profile">
                <img [src]="auth.user.profile?.avatar" class="menu-profile-img" onerror="this.src='assets/images/default-user.png'" />
                <div class="menu-profile-info">
                  <b class="menu-profile-name">{{ auth.user.profile?.name }}</b>
                  {{ '@' + auth.user.username }} asdasd
                </div>
              </div>
              <mat-divider></mat-divider>
              <a mat-menu-item routerLink="/{{ auth.user.username }}">
                <mat-icon>person</mat-icon>
                <span>Profile</span>
              </a>
              <a mat-menu-item routerLink="/settings">
                <mat-icon>settings</mat-icon>
                <span>Settings</span>
              </a>
              <a mat-menu-item (click)="logout()">
                <mat-icon>logout</mat-icon>
                <span>Sign out</span>
              </a>
              <mat-divider></mat-divider>
            }
            <button mat-menu-item [matMenuPageLink]="'appearance'">
              <mat-icon>dark_mode</mat-icon>
              <span
                >Appearance:
                @switch (themeService.theme) {
                  @case ('light dark') {
                    Device theme
                  }
                  @case ('light') {
                    Light theme
                  }
                  @case ('dark') {
                    Dark theme
                  }
                }
              </span>
              <mat-icon class="mat-multi-page-menu-submenu">chevron_right</mat-icon>
            </button>
            <button mat-menu-item disabled>
              <mat-icon>translate</mat-icon>
              <span>Language: English</span>
              <mat-icon class="mat-multi-page-menu-submenu">chevron_right</mat-icon>
            </button>
            <button mat-menu-item disabled>
              <mat-icon>language</mat-icon>
              <span>Location: Argentina</span>
              <mat-icon class="mat-multi-page-menu-submenu">chevron_right</mat-icon>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item disabled>
              <mat-icon>settings</mat-icon>
              <span>Settings</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item disabled>
              <mat-icon>feedback</mat-icon>
              <span>Send feedback</span>
            </button>
          </menu-page>
          <menu-page pageId="appearance" title="Appearance">
            <p class="mat-muted mat-menu-item-info">Setting applies to this browser only</p>
            <button mat-menu-item (click)="themeService.set('light dark')">
              @if (themeService.theme === 'light dark') {
                <mat-icon>check</mat-icon>
              }
              <span [class.mat-menu-item-noicon]="themeService.theme !== 'light dark'">Use device theme</span>
            </button>
            <button mat-menu-item (click)="themeService.set('light')">
              @if (themeService.theme === 'light') {
                <mat-icon>check</mat-icon>
              }
              <span [class.mat-menu-item-noicon]="themeService.theme !== 'light'">Light theme</span>
            </button>
            <button mat-menu-item (click)="themeService.set('dark')">
              @if (themeService.theme === 'dark') {
                <mat-icon>check</mat-icon>
              }
              <span [class.mat-menu-item-noicon]="themeService.theme !== 'dark'">Dark theme</span>
            </button>
          </menu-page>
        </mat-multi-page-menu>
      </mat-menu>
    }
  </mat-toolbar>
</ng-template>

<ng-template #navigation let-fixed="fixed">
  <mat-nav-list class="nav-list">
    @for (link of navLinks; track link.route) {
      <a
        mat-list-item
        [routerLink]="link.route"
        routerLinkActive
        #route="routerLinkActive"
        [activated]="route.isActive"
        [routerLinkActiveOptions]="{ exact: true }"
        class="nav-list-item"
        [class.small]="fixed && (!$isLargeScreen || !$isFullNav)"
        (click)="drawer.close()"
      >
        <mat-icon matListItemIcon>{{ link.icon }}</mat-icon>
        <span matListItemTitle>{{ link.label }}</span>
      </a>
    }
  </mat-nav-list>
</ng-template>
