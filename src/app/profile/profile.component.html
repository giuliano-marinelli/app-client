@if (_profile.loading()) {
  <mat-spinner class="justify-self-center" diameter="60"></mat-spinner>
}
@if (!_profile.loading() && _profile.user()) {
  <div class="centered-section">
    <div class="mx-0 my-4 flex flex-row gap-4">
      <img
        class="img-thumbnail h-30 w-30 rounded-full max-sm:h-18 max-sm:w-18 md:h-40 md:w-40"
        alt="Profile picture"
        onerror="this.src='assets/images/default-user.png'"
        [src]="_profile.user()?.profile?.avatar"
      />
      <div class="flex flex-col">
        <h1 class="text-4xl max-sm:text-2xl">
          {{ _profile.user()?.profile?.name }}
          @if (_profile.user()?.primaryEmail?.verified) {
            <mat-icon>
              <verified-mark [verified]="_profile.user()?.primaryEmail?.verified" />
            </mat-icon>
          }
        </h1>
        <h3 class="text-sm max-sm:text-xs">
          {{ '@' + _profile.user()?.username }}
          @if (_profile.user()?.profile?.location) {
            <span class="text-muted font-light"> Â· {{ _profile.user()?.profile?.location }}</span>
          }
        </h3>
        @if (!$isSmallScreen) {
          <ng-container [ngTemplateOutlet]="bio"></ng-container>
          <ng-container [ngTemplateOutlet]="actions"></ng-container>
        }
      </div>
    </div>

    @if ($isSmallScreen) {
      <div class="mb-4 sm:hidden">
        <ng-container [ngTemplateOutlet]="bio"></ng-container>
        <ng-container [ngTemplateOutlet]="actions"></ng-container>
      </div>
    }

    <ng-template #bio>
      <div class="mt-3 cursor-pointer font-light" (click)="_dialog.open(info)">
        <span class="text-muted">{{ $isSmallScreen ? _profile.user()?.profile?.bio?.substring(0, 100) : _profile.user()?.profile?.bio }}</span>
        <span class="font-bold"> {{ 'profile.buttons.moreText' | transloco }}</span>
      </div>
    </ng-template>

    <ng-template #actions>
      @if (_profile.user()?.id === _auth.user?.id) {
        <div class="mt-3 max-sm:flex">
          <a matButton="tonal" class="grow" routerLink="/settings/profile">{{ 'profile.buttons.editProfile' | transloco }}</a>
        </div>
      }
    </ng-template>

    <ng-template #info>
      <h2 mat-dialog-title class="dialog-with-close">
        {{ _profile.user()?.profile?.name }}
        <button matIconButton [mat-dialog-close]="true">
          <mat-icon>close</mat-icon>
        </button>
      </h2>
      <mat-dialog-content>
        @if (_profile.user()?.profile?.bio) {
          <h2>{{ 'profile.moreInfo.description' | transloco }}</h2>
          <p class="my-5">{{ _profile.user()?.profile?.bio }}</p>
        }
        <h2>{{ 'profile.moreInfo.moreInfo' | transloco }}</h2>
        @if (_profile.user()?.profile?.publicEmail?.address) {
          <p class="dialog-icon-item">
            <mat-icon>email</mat-icon>
            <a href="mailto:{{ _profile.user()?.profile?.publicEmail?.address }}">{{ _profile.user()?.profile?.publicEmail?.address }}</a>
          </p>
        }
        @if (_profile.user()?.profile?.url) {
          <p class="dialog-icon-item">
            <mat-icon>language</mat-icon>
            <a href="{{ _profile.user()?.profile?.url }}" target="_blank">{{ _profile.user()?.profile?.url }}</a>
          </p>
        }
        @if (_profile.user()?.profile?.location) {
          <p class="dialog-icon-item">
            <mat-icon>location_on</mat-icon>
            {{ _profile.user()?.profile?.location }}
          </p>
        }
        <p class="dialog-icon-item">
          <mat-icon>info_outline</mat-icon>
          {{ 'profile.moreInfo.joinedAt' | transloco: { date: (_profile.user()?.createdAt | amLocal | amDateFormat: 'LL') } }}
        </p>
      </mat-dialog-content>
    </ng-template>

    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" class="headed-tabs">
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="mr-2">menu_book</mat-icon>
          {{ 'profile.nav.overview' | transloco }}
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="mr-2">web_stories</mat-icon>
          {{ 'profile.nav.posts' | transloco }}
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>

  <mat-divider></mat-divider>
}
