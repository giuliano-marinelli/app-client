@if (userLoading && !user) {
  <mat-spinner class="justify-self-center" diameter="60"></mat-spinner>
} @else if (!user) {
  <div class="flex flex-col items-center justify-self-center"><mat-icon class="icon-size-20 text-muted!">search_off</mat-icon> No account found</div>
} @else {
  <h2>
    Change username
    <mat-spinner class="ml-2 inline-block!" [hidden]="!userLoading" diameter="24"></mat-spinner>
  </h2>
  <mat-divider class="mt-2!"></mat-divider>
  <form [class.loading]="userLoading" [formGroup]="usernameForm">
    <div class="md:max-w-100">
      <mat-form-field class="mt-3 w-full" [floatLabel]="'always'" [subscriptSizing]="'dynamic'" appearance="outline">
        <input matInput formControlName="username" autocomplete="off" />
        <mat-icon matPrefix>person_pin_circle</mat-icon>
        <mat-icon matSuffix>
          @if (username.pending) {
            <mat-spinner diameter="20"></mat-spinner>
          }
        </mat-icon>
        <mat-error>
          <invalid-feedback
            [control]="username"
            [messages]="{ pattern: 'Username can only have characters, numbers and _ or - symbols' }"
            name="Username"
          ></invalid-feedback>
        </mat-error>
      </mat-form-field>
      <button
        class="mt-3 whitespace-nowrap"
        [disabled]="!usernameForm.valid || updateSubmitLoading || deleteSubmitLoading"
        (click)="updateUsername()"
        matButton="tonal"
      >
        @if (updateSubmitLoading) {
          <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
        }
        Update profile
      </button>
    </div>

    <h2 class="text-error mt-6">Delete account</h2>
    <mat-divider class="mt-2!"></mat-divider>
    <p class="mt-3">Once you delete your account, there is no going back. Please be certain.</p>
    <button
      class="error mt-3 whitespace-nowrap"
      [disabled]="updateSubmitLoading || deleteSubmitLoading"
      (click)="confirmDelete.open(); $event.preventDefault()"
      matButton="outlined"
    >
      @if (deleteSubmitLoading) {
        <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
      }
      Delete your account
    </button>
    <confirm #confirmDelete [requiredPassword]="true" [requiredVerificationCode]="true" (confirm)="deleteUser($event)"></confirm>
  </form>
}
