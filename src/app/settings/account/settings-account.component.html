@if (userLoading && !user) {
  <mat-spinner class="justify-self-center" diameter="60"></mat-spinner>
} @else if (!user) {
  <div class="flex flex-col items-center justify-self-center">
    <mat-icon class="icon-size-20 text-muted!">search_off</mat-icon> {{ 'searchMessages.noAccount' | transloco }}
  </div>
} @else {
  <h2>
    {{ 'settings.account.usernameForm.title' | transloco }}
    <mat-spinner class="ml-2 inline-block!" diameter="24" [hidden]="!userLoading"></mat-spinner>
  </h2>
  <mat-divider class="mt-2!"></mat-divider>
  <form [class.loading]="userLoading" [formGroup]="usernameForm">
    <div class="md:max-w-100">
      <mat-form-field class="mt-3 w-full" appearance="outline" [floatLabel]="'always'" [subscriptSizing]="'dynamic'">
        <input matInput formControlName="username" autocomplete="off" />
        <mat-icon matPrefix>person_pin_circle</mat-icon>
        <mat-icon matSuffix>
          @if (username.pending) {
            <mat-spinner diameter="20"></mat-spinner>
          }
        </mat-icon>
        <mat-error>
          <invalid-feedback
            name="{{ 'settings.account.usernameForm.labels.username' | transloco }}"
            [control]="username"
            [messages]="{ pattern: ('settings.account.errors.usernamePattern' | transloco) }"
          ></invalid-feedback>
        </mat-error>
      </mat-form-field>
      <button
        matButton="tonal"
        class="mt-3 whitespace-nowrap"
        [disabled]="!usernameForm.valid || updateSubmitLoading || deleteSubmitLoading"
        (click)="updateUsername()"
      >
        @if (updateSubmitLoading) {
          <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
        }
        {{ 'settings.account.usernameForm.buttons.submit' | transloco }}
      </button>
    </div>

    <h2 class="text-error mt-6">{{ 'settings.account.deleteAccountForm.title' | transloco }}</h2>
    <mat-divider class="mt-2!"></mat-divider>
    <p class="mt-3">{{ 'settings.account.deleteAccountForm.hints.warning' | transloco }}</p>
    <button
      matButton="outlined"
      class="error mt-3 whitespace-nowrap"
      [disabled]="updateSubmitLoading || deleteSubmitLoading"
      (click)="confirmDelete.open(); $event.preventDefault()"
    >
      @if (deleteSubmitLoading) {
        <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
      }
      {{ 'settings.account.deleteAccountForm.buttons.submit' | transloco }}
    </button>
    <confirm #confirmDelete [requiredPassword]="true" [requiredVerificationCode]="true" (confirm)="deleteUser($event)"></confirm>
  </form>
}
