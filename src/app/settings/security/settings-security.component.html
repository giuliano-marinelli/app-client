@if (userLoading && !user) {
  <mat-spinner class="justify-self-center" diameter="60"></mat-spinner>
} @else if (!user) {
  <div class="flex flex-col items-center justify-self-center"><mat-icon class="icon-size-20 text-muted!">search_off</mat-icon> No account found</div>
} @else {
  <h2>
    Change password
    <mat-spinner class="ml-2 inline-block!" diameter="24" [hidden]="!userLoading"></mat-spinner>
  </h2>
  <mat-divider class="mt-2!"></mat-divider>
  <form [formGroup]="passwordForm">
    <div class="md:max-w-100">
      <mat-form-field
        class="mt-3 w-full"
        appearance="outline"
        *var="{ active: true } as hidden"
        [floatLabel]="'always'"
        [subscriptSizing]="'dynamic'"
        [hideRequiredMarker]="true"
      >
        <mat-label>Old password</mat-label>
        <input matInput formControlName="oldPassword" autocomplete="off" [type]="hidden.active ? 'password' : 'text'" />
        <button matIconButton matSuffix (click)="hidden.active = !hidden.active; $event.preventDefault()">
          <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error>
          <invalid-feedback name="Password" [control]="oldPassword"></invalid-feedback>
        </mat-error>
      </mat-form-field>

      <mat-form-field
        class="mt-3 w-full"
        appearance="outline"
        *var="{ active: true } as hidden"
        [floatLabel]="'always'"
        [subscriptSizing]="'dynamic'"
        [hideRequiredMarker]="true"
      >
        <mat-label>New password</mat-label>
        <input matInput formControlName="newPassword" autocomplete="off" [type]="hidden.active ? 'password' : 'text'" />
        <button matIconButton matSuffix (click)="hidden.active = !hidden.active; $event.preventDefault()">
          <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error>
          <invalid-feedback name="Password" [control]="newPassword"></invalid-feedback>
        </mat-error>
      </mat-form-field>

      <mat-form-field
        class="mt-3 w-full"
        appearance="outline"
        *var="{ active: true } as hidden"
        [floatLabel]="'always'"
        [subscriptSizing]="'dynamic'"
        [hideRequiredMarker]="true"
      >
        <mat-label>Confirm new password</mat-label>
        <input matInput formControlName="confirmNewPassword" autocomplete="off" [type]="hidden.active ? 'password' : 'text'" />
        <button matIconButton matSuffix (click)="hidden.active = !hidden.active; $event.preventDefault()">
          <mat-icon>{{ hidden.active ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error>
          <invalid-feedback name="Password" [control]="confirmNewPassword" [messages]="{ equalTo: 'Passwords must be equals' }"></invalid-feedback>
        </mat-error>
      </mat-form-field>

      <button matButton="tonal" class="mt-3 whitespace-nowrap" [disabled]="!passwordForm.valid || updateSubmitLoading" (click)="updatePassword()">
        @if (updateSubmitLoading) {
          <mat-icon><mat-spinner diameter="17"></mat-spinner></mat-icon>
        }
        Update password
      </button>
    </div>
    <h2 class="mt-6">Two-factor authentication</h2>
    <mat-divider class="mt-2!"></mat-divider>
    <p class="mt-3">
      Two-factor authentication adds an additional layer of security to your account by requiring more than just a password to sign in.
    </p>
  </form>
}
